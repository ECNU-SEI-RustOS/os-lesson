#### 实验三：并发素数筛

**实验要求**

编写一个使用管道（pipes）的并发版素数筛选程序。这个想法来自 Unix 管道的发明者 Doug McIlroy。这个网页[Bell Labs and CSP Threads](https://swtch.com/~rsc/thread/)的图片和相关文字解释了如何实现它。你的C语言版本实现应写在文件 `user/primes.c` 中。**同时尝试使用Rust语言实现相同的功能，写在`user_rust/src/bin/primes_rust.rs`中。**

你的目标是使用 `pipe` 和 `fork` 来构建一个流水线（pipeline）。第一个进程将数字 2 到 35 依次写入这条流水线。对于每一个素数，你需要安排一个进程：它通过管道从左边的邻居读取数据，再通过另一个管道向右边的邻居写数据。由于内核对文件描述符和进程数量有限制，第一个进程可以在数字 35 时停止。

**实验提示**

- 要小心关闭进程中不需要的文件描述符，否则在第一个进程到达数字 35 之前，你的程序可能会因为资源耗尽而导致内核无法运行。
- 一旦第一个进程处理到数字 35，它应当等待整个流水线中的所有进程终止，包括所有的子进程、孙进程等。因此，主进程 `primes` 只有在所有输出完成并且所有其他 `primes` 进程都退出之后才能退出。
- 提示：当管道的写端被关闭时，`read` 会返回 0。
- 最简单的做法是直接将 32 位（4 字节）的整数写入管道，而不是使用格式化的 ASCII 输入/输出。
- 只有在需要时，才创建流水线中的新进程。
- 在 `Makefile` 的 `UPROGS` 中添加该程序。

**实验效果**

```
init: starting sh
$ primes
prime 2
prime 3
prime 5
prime 7
prime 11
prime 13
prime 17
prime 19
prime 23
prime 29
prime 31
$ primes_rust
prime 2
prime 3
prime 5
prime 7
prime 11
prime 13
prime 17
prime 19
prime 23
prime 29
prime 31
$ 
```

